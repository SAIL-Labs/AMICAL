
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.2, mkdocs-material-7.2.1">
    
    
      
        <title>General Tutorial - AMICAL - Aperture Masking Interferometry Calibration and Analysis Library</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.1118c9be.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.ba0d045b.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    
      


    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    <script>function __prefix(e){return new URL("..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#tutorials" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="AMICAL - Aperture Masking Interferometry Calibration and Analysis Library" class="md-header__button md-logo" aria-label="AMICAL - Aperture Masking Interferometry Calibration and Analysis Library" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            AMICAL - Aperture Masking Interferometry Calibration and Analysis Library
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              General Tutorial
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/SydneyAstrophotonicInstrumentationLab/AMICAL/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="AMICAL - Aperture Masking Interferometry Calibration and Analysis Library" class="md-nav__button md-logo" aria-label="AMICAL - Aperture Masking Interferometry Calibration and Analysis Library" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    AMICAL - Aperture Masking Interferometry Calibration and Analysis Library
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/SydneyAstrophotonicInstrumentationLab/AMICAL/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" checked>
      
      <label class="md-nav__link" for="__nav_2">
        Tutorials
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Tutorials" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Tutorials
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          General Tutorial
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        General Tutorial
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#step-1-clean-and-select-data" class="md-nav__link">
    Step 1: clean and select data
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-2-extract-observables" class="md-nav__link">
    Step 2: extract observables
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-3-calibrate-v2-cp" class="md-nav__link">
    Step 3: calibrate V2 &amp; CP
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/example_NIRISS/" class="md-nav__link">
        NIRISS Calibration with AMICAL
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/example_SPHERE/" class="md-nav__link">
        Analysing SPHERE Data
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../notebooks/example_analysis/" class="md-nav__link">
        Bayesian Inference with CANDID &amp; Pymask
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#step-1-clean-and-select-data" class="md-nav__link">
    Step 1: clean and select data
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-2-extract-observables" class="md-nav__link">
    Step 2: extract observables
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-3-calibrate-v2-cp" class="md-nav__link">
    Step 3: calibrate V2 &amp; CP
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/SydneyAstrophotonicInstrumentationLab/AMICAL/edit/master/docs/tutorial.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="tutorials">Tutorials</h1>
<p>In this tutorial, we will go through different features of AMICAL. You
can find a detailed description of the principal functions and associated
parameters in their docstrings (easily accessible with good editors, e.g.:
vscode).</p>
<ul>
<li><a href="#step-1-clean-and-select-data">Step 1: clean and select data</a></li>
<li><a href="#step-2-extract-observables">Step 2: extract observables</a></li>
<li><a href="#step-3-calibrate-v2--cp">Step 3: calibrate V2 &amp; CP</a></li>
<li><a href="#step-4-analyse-with-candid-and-pymask">Step 4: analyse with CANDID and
  Pymask</a></li>
</ul>
<p>In the following, we'll assume you imported the library as:</p>
<pre><code class="language-python">import amical
</code></pre>
<h3 id="step-1-clean-and-select-data">Step 1: clean and select data</h3>
<p>The major part of data coming from general pipelines (applying dark, flat,
distorsion, etc.) are not enought compliant with the Fourier extracting method
developed within AMICAL.</p>
<p>The first step of running AMICAL consists in cleaning the data in different ways:</p>
<ul>
<li>Remove residual sky background (<code>sky=True</code>, <code>r1</code>, <code>dr</code>)</li>
<li>Crop and center the image (<code>isz</code>, <code>f_kernel=3</code>),</li>
<li>Apply windowing (<code>apod</code>, <code>window</code>),</li>
<li>Apply bad pixels correction (<code>bad_map=None</code>, <code>add_bad=[]</code>,
  <code>remove_bad=False</code>).</li>
</ul>
<p>We use a 2d gaussian interpolation to replace the bad pixels (same as
<a href="https://docs.astropy.org/en/stable/convolution/">here</a>). The keyword argument <code>bad_map</code> is
a 2D array (same shape as the data) filled with 0 and 1 where 1 stands for a bad
pixel (hot, cosmic, etc.). Instrument pipelines generally come with bad pixels
map generator, but you can add an unlimited number of bad pixels as the input
list <code>add_bad</code> (e.g.: [[24, 08], [31, 41]])).</p>
<pre><code class="language-python">nrm_file = &quot;my_nrm_data.fits&quot;

clean_param = {
    &quot;isz&quot;: 69,  # final cropped image size [pix]
    &quot;r1&quot;: 31,  # Inner radius to compute sky [pix]
    &quot;dr&quot;: 2,  # Outer radius (r2 = r1 + dr)
    &quot;apod&quot;: True,  # If True, apply windowing
    &quot;window&quot;: 32,  # FWHM of the super-gaussian (for windowing)
}

# Firsly, check if the input parameters are valid
amical.show_clean_params(nrm_file, **clean_param)
</code></pre>
<p align="center">
<img src="Figures/cleaning_params.png" width="50%"/>
</p>

<p><em><strong>FIG. 1</strong> - Example of appropriate set of parameters to clean NIRISS data.</em></p>
<p>If the cleaning parameters seem well located (cyan cross on the centre, sky
radius outside the fringes pattern, etc.), we can apply the cleaning step to the
data.</p>
<pre><code class="language-python">cube_cleaned = amical.select_clean_data(
    nrm_file, **clean_param, clip=True, clip_fact=0.5
)
</code></pre>
<p>During the cleaning step, you can decide to apply a lucky imaging selection
(<code>clip=True</code>) to accumulate only the best frames in the cube (based on the
integrated fluxes compared to the median: threshold = median(fluxes) -
<code>clip_fact</code> * std(fluxes)).</p>
<p align="center">
<img src="Figures/clipping.png" width="80%"/>
</p>

<p><em><strong>FIG. 2</strong> - Example of integrated flux measurement along the cube (# frames).
The rejected frames are labelled by the red cross. The threshold is represented
with the green dashed line.</em></p>
<h3 id="step-2-extract-observables">Step 2: extract observables</h3>
<p>The second step is the core of AMICAL: we use the Fourier sampling approach to
extract the interferometric observables (visibilities and closure phases).</p>
<p>The whole challenge when playing with the NRM data is to find the correct
position of each baseline in the Fourier transform. To do so, we implemented 4
different sampling methods (<code>peakmethod</code> = ('unique', 'square', 'gauss', 'fft'))
to exploit information spread beyond just the <em>u</em>, <em>v</em> positions (see
our SPIE 2020 <a href="https://ui.adsabs.harvard.edu/abs/2020SPIE11446E..11S/abstract">reference
paper</a> for more
details).</p>
<p align="center">
<img src="Figures/fft.png" width="60%"/>
</p>

<p><strong><em>FIG. 3</em>* - Example of NIRISS data. </strong>Left:<strong> Image plane representing the fringe
pattern. </strong>Right:*<em> Fourier transform (Fourier plane).</em></p>
<p align="center">
<img src="Figures/peakmethod.png" width="80%"/>
</p>

<p><em><strong>FIG. 4</strong> - Zoom on one Fourier peak (called splodge) showing the different sampling methods.</em></p>
<p>Based on NIRISS and SPHERE dataset analysis, we recommend using the <code>'fft'</code>
method (but feel free to test the other methods for your specific case!). The
expected baseline locations on the detector are computed using the mask
coordinates, the wavelength and the pixel size. In some cases, the mask is not
perfectly aligned with the detector and so requires to be rotated
(<code>theta_detector = 0</code>) or centrally scaled (<code>scaling_uv = 1</code>).</p>
<p>With AMICAL, the mask coordinates, the wavelengths, the pixel size and the
target name are normally read from the fits file header.
In case where headers are not compliant, you will need to provide the following keyword arguments: <code>filtname</code>, <code>instrum</code> and <code>targetname</code>.</p>
<pre><code class="language-python">params_ami = {
    &quot;peakmethod&quot;: &quot;fft&quot;,
    &quot;maskname&quot;: &quot;g7&quot;,  # 7 holes mask of NIRISS
}

bs = amical.extract_bs(cube_cleaned, file_t, **params_ami)
</code></pre>
<blockquote>
<p>Note: Other parameters in <code>amical.extract_bs()</code> are rarely modified but you
can check the docstrings for details
(<a href="https://github.com/SydneyAstrophotonicInstrumentationLab/AMICAL/blob/master/amical/mf_pipeline/bispect.py">bispect.py</a>).</p>
</blockquote>
<p>The object <code>bs</code> stores the raw observables (<code>bs.vis2</code>, <code>bs.e_vis2</code>, <code>bs.cp</code>,
<code>bs.e_cp</code>), the u-v coordinates and wavelength (<code>bs.u</code>, <code>bs.v</code>, <code>bs.wl</code>), the
baseline lengths (<code>bs.bl</code>, <code>bs.bl_cp</code>), information relative to the used mask
(<code>bs.mask</code>), the computed matrices and statistic (<code>bs.matrix</code>) and the important
information (<code>bs.infos</code>). The <code>mask</code>, <code>infos</code> and <code>matrix</code> attributes also hold various data.</p>
<pre><code class="language-python">print(bs.keys(), bs.mask.keys())
</code></pre>
<h3 id="step-3-calibrate-v2-cp">Step 3: calibrate V2 &amp; CP</h3>
<p>Closure phases and square visibilities suffer from systematic terms, caused by
the wavefront fluctuations (temporal, polychromatic sources, non-zero size mask,
etc.). To calibrate aperture masking data, these quantities are measured on one or several identified unresolved (or known size) calibration stars. In practice, we subtract the
calibrator signal from the raw closure phases and normalize the target
visibilities by the calibrator’s visibilities.</p>
<pre><code class="language-python"># bs_t and bs_c are the results from amical.extract_bs() on the target and
# calibrator respectively.
cal = amical.calibrate(bs_t, bs_c)
</code></pre>
<p>If several calibrators are available, the calibration factors are computed using
a weighted average to account for variations between sources. In this case,
<code>bs_c</code> will be a list of results from <code>amical.extract_bs()</code>. The extra errors
induced are then quadratically added to the calibrated uncertainties.</p>
<p>During the calibration procedure, a second data selection can be performed to
reject bad calibrator-source pairs using a sigma-clipping approach (<code>clip=True</code>,
using a threshold value in sigma <code>sig_thres=2</code>).</p>
<p>```python             }
cal = amical.calibrate(bs_t, [bs_c1, bs_c2, bs_c3], clip=True, sig_thres=2)</p>
<pre><code>
&gt; Note: For ground based facilities, two additional corrections can be applied
&gt; on V2 to deal with potential piston between holes (`apply_phscorr=True`) or
&gt; seeing/wind shacking variations (`apply_atmcorr=True`). This functionnality
&gt; was only tested on old dataset from the previous IDL pipeline, and so needs to
&gt; be cautiously used (seem to not working on SPHERE data).

&gt; Note: You can decide to normalize the CP uncertaintities by sqrt(n_holes/3)
&gt; take into account the dependant vs. independant closure phases
&gt; (`normalize_err_indep=True`).

Once again, `cal` is an object containing the calibrated observables
(`cal.vis2`, `cal.e_vis2`, etc.), u-v coordinates (`cal.u`, `cal.v`, `cal.u1`,
`cal.v2`, etc.), wavelength (`cal.wl`) and the output objects from step 2
(`cal.raw_t`, `cal.raw_c`).

You can now visualize the calibrated observables with `amical.show()` and save
them as the standard oifits file with amical.save().

```python
amical.show(cal, cmax=1, vmin=0.97, vmax=1.01)
</code></pre>
<p align="center">
<img src="Figures/results_show.png" width="100%"/>
</p>
<p align="center">

***FIG. 5** - Example of calibrated observables obtained with NIRISS. **Left:** u-v
plan, **Top-right:** squared visibilities, **Lower-right:** Closure phases.*

By default, we assume that the u-v plan is oriented on the detector
(north-up, east-left) with `pa=0` in degrees. The true position angle is
normally computed during the step 2 (not yet available for all instruments) and
so need to be given as input with `pa=bs.infos.pa`.

Few other parameters are available to set the axe limites (`vmax`, `vmin`,
`cmax`), set units (`unit`, `unit_cp`), log scale (`setlog`), flags
(`true_flag_v2`, `true_flag_cp`), etc.


<pre><code class="language-python">oifits_file = &quot;my_oifits_results.oifits&quot;

amical.save(cal, oifits_file, pa=bs_t.infos.pa)
</code></pre>


If you want to save the independent CP only, you can add `ind_hole=0`
(0..n_holes-1) to select only the CP with the given aperture index. The others
parameters can be check in the docstrings.

> Note: If data are extracted from a fake target, you have to add
> `fake_obj=True` to ignore the SIMBAD search.

### Step 4: analyse with CANDID and Pymask

Finally, you can fit the data using CANDID or Pymask (two independant and
stand-alone packages).

First, you can use CANDID to fit the data using a grid search approach.


<pre><code class="language-python">inputdata = &quot;Saveoifits/my_oifits_results.oifits&quot;

param_candid = {
    &quot;rmin&quot;: 20,  # inner radius of the grid
    &quot;rmax&quot;: 250,  # outer radius of the grid
    &quot;step&quot;: 50,  # grid sampling
    &quot;ncore&quot;: 12,  # core for multiprocessing
}

fit1 = amical.candid_grid(inputdata, **param_candid, diam=0, doNotFit=[&quot;diam*&quot;])
</code></pre>


<p align="center">
<img src="Figures/example_fit_candid.png" width="80%"/>
</p>

***FIG. 6** - Example of CANDID fit showing the location of the detected companion (red cross) and the associated detection map.*

And an estimate of the contrast limit.


<pre><code class="language-python">cr_candid = amical.candid_cr_limit(inputdata, **param_candid, fitComp=fit1[&quot;comp&quot;])
</code></pre>


<p align="center">
<img src="Figures/example_crlimits_candid.png" width="60%"/>
</p>

***FIG. 7** - Example of CANDID contrast limit map (top panel) and detection limit curve (lower panel). For this dataset, the contrast limit achieved is around 8.5 magnitudes (3-σ).*

For a detailled description and the use of Pymask package (using the MCMC
approach), you can check the [example_analysis.py](example_analysis.py) script.
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href=".." class="md-footer__link md-footer__link--prev" aria-label="Previous: Home" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Home
            </div>
          </div>
        </a>
      
      
        
        <a href="../notebooks/example_NIRISS/" class="md-footer__link md-footer__link--next" aria-label="Next: NIRISS Calibration with AMICAL" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              NIRISS Calibration with AMICAL
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../assets/javascripts/workers/search.53c85856.min.js", "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.716f8af4.min.js"></script>
      
        <script src="../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>